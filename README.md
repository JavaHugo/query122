# 122官方API

## 更新

1. 更新了安徽省的接口，该省迭代频繁，调研时候js算token，然后变为请求指定url

2. 2019-01-07 处理完山西省

## 请求接口部分

针对不同的省份请求的参数

需要根据实际每个省的参数来定制

同时验证码，要根据每个省份来专门定制

### 流程

1. 进入对于省份首页，拿到cookie
2. 拿到验证码
3. 请求数据

## 验证码部分

验证码识别部分，需要集成到到爬虫里
不能单独

svm不能处理验证码，不能切片，这个就坑爹了

走打码平台

## 使用说明

### 部署位置:
    
    http://47.97.181.94:24122/122
    
    method: POST
    
    payloads = {
                'carNo': '川A12345',
                'engineNo': 'xxxxxxx',
                'vin': 'xxxxxxxx'
                }

### 启动

    需要启动两个进程：
    
    1. web server
    nohup python3 offical_122_web_server.py &
    
    2. 余额循环接口
    nohup python3 fateadm_ocr.py &
    
### 运行
    
    1. web server提供api
    2. fateadm_ocr 提供打码平台的 查询 退单 ocr过程
       自动运行过程中每一小时自动获取一次余额信息

### 接口返回
    
    type: json
    
    示例:
    1. 正确
    '{"code": 200, "data": {"total": 22, "bs": 9, "bd": 10, "ws": 3}, "msg": "操作成功！"}'
    
    2. 验证码错误
    '{"code": 499, "data": {"total": "", "bs": "", "bd": "", "ws": ""}, "msg": "图片验证码输入错误"}'
    
    3. 输入参数错误
    '{"code": 500, "data": {"total": "", "bs": "", "bd": "", "ws": ""}, "msg": "根据您提交的信息，无法查询到违法记录。请核实您提交的信息是否准确。"}'
    
    4. 接口错误
    '{"code": 0, "data": {"total": "", "bs": "", "bd": "", "ws": ""}, "msg": ""}'


### 字段说明

|字段|解释|示例|
|:-:|:-:|:-:|
|code|接口返回状态码|200，499，500，0|
|data|接口返回数据|{xxxx}|
|total|总违章数量|22|
|bs|本省内违章数量，不包括本地|9|
|bd|本地违章数量|9|
|ws|外省的位置数量|3|
|msg|信息|操作成功|
